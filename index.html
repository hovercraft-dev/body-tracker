<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="theme-color" content="#0d1117">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<link rel="manifest" href="manifest.json">
<link rel="icon" href="icon.svg" type="image/svg+xml">
<link rel="apple-touch-icon" href="icon.svg">
<title>Body Tracker</title>
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  html, body {
    height: 100%;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
    background: #0d1117;
    color: #c9d1d9;
    -webkit-tap-highlight-color: transparent;
  }

  body {
    display: flex;
    justify-content: center;
    padding: 2rem 1.25rem;
  }

  .app {
    width: 100%;
    max-width: 400px;
  }

  h1 {
    font-size: 1.5rem;
    font-weight: 700;
    letter-spacing: -0.02em;
    color: #e6edf3;
    margin-bottom: 2rem;
  }

  .field {
    margin-bottom: 1.25rem;
  }

  label {
    display: block;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: #7d8590;
    margin-bottom: 0.5rem;
  }

  input {
    width: 100%;
    padding: 1rem;
    font-size: 1.25rem;
    font-weight: 500;
    font-family: inherit;
    color: #e6edf3;
    background: #161b22;
    border: 1.5px solid #30363d;
    border-radius: 10px;
    outline: none;
    transition: border-color 0.15s;
    -webkit-appearance: none;
  }

  input:focus {
    border-color: #00e59a;
  }

  input[type="date"] {
    color-scheme: dark;
  }

  .unit {
    position: relative;
  }

  .unit::after {
    content: attr(data-unit);
    position: absolute;
    right: 1rem;
    top: 50%;
    transform: translateY(-50%);
    font-size: 0.875rem;
    font-weight: 600;
    color: #484f58;
    pointer-events: none;
  }

  .unit input {
    padding-right: 3rem;
  }

  button {
    width: 100%;
    padding: 1rem;
    margin-top: 0.75rem;
    font-size: 1.125rem;
    font-weight: 700;
    font-family: inherit;
    color: #0d1117;
    background: #00e59a;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    transition: opacity 0.15s;
    -webkit-appearance: none;
  }

  button:active {
    opacity: 0.8;
  }

  button:disabled {
    opacity: 0.4;
    cursor: not-allowed;
  }

  /* ── Setup overlay ── */
  .setup {
    position: fixed;
    inset: 0;
    background: #0d1117;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 1.25rem;
    z-index: 100;
  }

  .setup.hidden { display: none; }

  .setup-card {
    width: 100%;
    max-width: 400px;
  }

  .setup-card h2 {
    font-size: 1.25rem;
    color: #e6edf3;
    margin-bottom: 0.5rem;
  }

  .setup-card p {
    font-size: 0.8rem;
    color: #7d8590;
    margin-bottom: 1.25rem;
    line-height: 1.5;
  }

  .setup-card input {
    width: 100%;
    padding: 1rem;
    font-size: 0.95rem;
    font-weight: 500;
    font-family: inherit;
    color: #e6edf3;
    background: #161b22;
    border: 1.5px solid #30363d;
    border-radius: 10px;
    outline: none;
    margin-bottom: 1rem;
  }

  .setup-card input:focus { border-color: #00e59a; }

  .setup-card button {
    width: 100%;
    padding: 1rem;
    font-size: 1rem;
    font-weight: 700;
    font-family: inherit;
    color: #0d1117;
    background: #00e59a;
    border: none;
    border-radius: 10px;
    cursor: pointer;
  }

  .toast {
    position: fixed;
    bottom: 2rem;
    left: 50%;
    transform: translateX(-50%) translateY(120%);
    background: #1c2b1f;
    color: #00e59a;
    font-size: 0.9rem;
    font-weight: 600;
    padding: 0.75rem 1.5rem;
    border-radius: 8px;
    border: 1px solid #238636;
    opacity: 0;
    transition: transform 0.3s ease, opacity 0.3s ease;
    pointer-events: none;
  }

  .toast.show {
    transform: translateX(-50%) translateY(0);
    opacity: 1;
  }
</style>
</head>
<body>

<!-- ── Setup overlay ── -->
<div class="setup" id="setup">
  <div class="setup-card">
    <h2>Setup</h2>
    <p>Paste your Google Apps Script endpoint URL to connect this tracker.</p>
    <input type="url" id="endpointInput" placeholder="https://script.google.com/macros/s/AKfycbz1f3FYxDoaTaxJmeAy1FEkjJRUwukJkMOPFyO57JNlvaEYgHMo4smCW5dlfCRClpIn/exec" autocomplete="off" spellcheck="false">
    <button type="button" id="saveEndpoint">Save</button>
  </div>
</div>

<div class="app">
  <h1>Body Tracker</h1>
  <form id="form">
    <div class="field">
      <label for="date">Date</label>
      <input type="date" id="date" required>
    </div>
    <div class="field">
      <label for="weight">Weight</label>
      <div class="unit" data-unit="kg">
        <input type="number" id="weight" inputmode="decimal" step="0.1" min="0" max="300" placeholder="0.0" required>
      </div>
    </div>
    <div class="field">
      <label for="waist">Waist</label>
      <div class="unit" data-unit="cm">
        <input type="number" id="waist" inputmode="decimal" step="0.1" min="0" max="200" placeholder="0.0" required>
      </div>
    </div>
    <div class="field">
      <label for="hips">Hips</label>
      <div class="unit" data-unit="cm">
        <input type="number" id="hips" inputmode="decimal" step="0.1" min="0" max="200" placeholder="0.0" required>
      </div>
    </div>
    <button type="submit">Submit</button>
  </form>
</div>

<div class="toast" id="toast">Logged</div>

<script>
// ── ENDPOINT (stored in localStorage) ──
const STORAGE_KEY = 'apps_script_url';
let APPS_SCRIPT_URL = localStorage.getItem(STORAGE_KEY) || '';

const setupOverlay = document.getElementById('setup');
const endpointInput = document.getElementById('endpointInput');
document.getElementById('saveEndpoint').addEventListener('click', () => {
  const url = endpointInput.value.trim();
  if (!url) return;
  localStorage.setItem(STORAGE_KEY, url);
  APPS_SCRIPT_URL = url;
  setupOverlay.classList.add('hidden');
});
if (APPS_SCRIPT_URL) setupOverlay.classList.add('hidden');

const form = document.getElementById('form');
const dateInput = document.getElementById('date');
const toast = document.getElementById('toast');

function todayStr() {
  const d = new Date();
  return `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}-${String(d.getDate()).padStart(2, '0')}`;
}

function resetForm() {
  form.reset();
  dateInput.value = todayStr();
}

function showToast() {
  toast.classList.add('show');
  setTimeout(() => toast.classList.remove('show'), 1800);
}

form.addEventListener('submit', async (e) => {
  e.preventDefault();
  const btn = form.querySelector('button');
  btn.disabled = true;

  const payload = {
    date: dateInput.value,
    weight: parseFloat(document.getElementById('weight').value),
    waist: parseFloat(document.getElementById('waist').value),
    hips: parseFloat(document.getElementById('hips').value)
  };

  try {
    fetch(APPS_SCRIPT_URL, {
  method: 'POST',
  mode: 'no-cors',
  body: JSON.stringify(data)
})
    showToast();
    resetForm();
  } catch (err) {
    alert('Failed to send. Check your connection.');
  } finally {
    btn.disabled = false;
  }
});

// Init
resetForm();

// Service worker
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('./sw.js');
}
</script>

</body>
</html>
